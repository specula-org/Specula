; MCetcdraft.ini
; TLC configuration for etcdraft model checking with snapshots

[wrapper]
stop on error: true
suppress error trace: true
no summary: true

[options]
target: ./MCetcdraft.tla
model name: MCetcdraft/sim
workers: auto
workers: SHOW_IN_TABLE
simulation depth: 200
check deadlock: false
community modules: true
memory ratio: 0.8
stop after: 150
simulation traces: 100
; simulation dump traces: true

[behavior]
temporal formula: mc_etcdSpec
temporal formula: mc_etcdSpecWithReady
temporal formula: SHOW_IN_TABLE

[invariants]
; Core Raft Safety Invariants
LogInv: LogInv
MoreThanOneLeaderInv: MoreThanOneLeaderInv
ElectionSafetyInv: ElectionSafetyInv
LogMatchingInv: LogMatchingInv
QuorumLogInv: QuorumLogInv
MoreUpToDateCorrectInv: MoreUpToDateCorrectInv
LeaderCompletenessInv: LeaderCompletenessInv
CommittedIsDurableInv: CommittedIsDurableInv
; Flow Control Safety
ProbeLimitInv: ProbeLimitInv
ReplicatePauseInv: ReplicatePauseInv
SnapshotInflightsInv: SnapshotInflightsInv
; Inflights Data Integrity
InflightsLogIndexInv: InflightsLogIndexInv
InflightsMatchIndexInv: InflightsMatchIndexInv
InflightsMonotonicInv: InflightsMonotonicInv
; Progress State Consistency
ProgressStateTypeInv: ProgressStateTypeInv
InflightsInv: InflightsInv
SnapshotPendingInv: SnapshotPendingInv
NoPendingSnapshotInv: NoPendingSnapshotInv
LeaderSelfReplicateInv: LeaderSelfReplicateInv
SnapshotStateInv: SnapshotStateInv
; Fundamental Progress Invariants
MatchIndexLessThanLogInv: MatchIndexLessThanLogInv
MatchIndexNonNegativeInv: MatchIndexNonNegativeInv
InflightsAboveMatchInv: InflightsAboveMatchInv
MatchIndexLessThanNextInv: MatchIndexLessThanNextInv
MsgAppFlowPausedConsistencyInv: MsgAppFlowPausedConsistencyInv
ProbeOneInflightMaxInv: ProbeOneInflightMaxInv
SnapshotNoInflightsStrictInv: SnapshotNoInflightsStrictInv
; Additional Safety Invariants
AllMessageTermsValid: AllMessageTermsValid
MessageIndexValidInv: MessageIndexValidInv
StateMachineConsistency: StateMachineConsistency
CommitIndexBoundInv: CommitIndexBoundInv
CommittedEntriesTermInv: CommittedEntriesTermInv
PendingConfigBoundInv: PendingConfigBoundInv
LeaderLogLengthInv: LeaderLogLengthInv
LogTermMonotonic: LogTermMonotonic
CurrentTermAtLeastLogTerm: CurrentTermAtLeastLogTerm
CandidateVotedForSelfInv: CandidateVotedForSelfInv
DurableStateConsistency: DurableStateConsistency
MessageEndpointsValidInv: MessageEndpointsValidInv
LeaderDurableTermInv: LeaderDurableTermInv
; P0 Log Structure Invariants
LogOffsetMinInv: LogOffsetMinInv
SnapshotOffsetConsistencyInv: SnapshotOffsetConsistencyInv
SnapshotTermValidInv: SnapshotTermValidInv
SnapshotTermBoundInv: SnapshotTermBoundInv
HistoryLogLengthInv: HistoryLogLengthInv
SnapshotCommitConsistencyInv: SnapshotCommitConsistencyInv
; P1 Configuration Invariants
JointConfigNonEmptyInv: JointConfigNonEmptyInv
SingleConfigOutgoingEmptyInv: SingleConfigOutgoingEmptyInv
LearnersVotersDisjointInv: LearnersVotersDisjointInv
ConfigNonEmptyInv: ConfigNonEmptyInv
PendingConfIndexValidInv: PendingConfIndexValidInv
; P1 Additional Progress Invariants
NextIndexPositiveInv: NextIndexPositiveInv
NextIndexBoundInv: NextIndexBoundInv
MatchIndexBoundInv: MatchIndexBoundInv
LeaderMatchSelfInv: LeaderMatchSelfInv
LeaderNextSelfInv: LeaderNextSelfInv
PendingSnapshotBoundInv: PendingSnapshotBoundInv
; P2 Message Content Invariants
SnapshotMsgIndexValidInv: SnapshotMsgIndexValidInv
SnapshotMsgTermValidInv: SnapshotMsgTermValidInv
AppendEntriesPrevIndexNonNegInv: AppendEntriesPrevIndexNonNegInv
AppendEntriesCommitBoundInv: AppendEntriesCommitBoundInv
VoteRequestLogIndexNonNegInv: VoteRequestLogIndexNonNegInv
VoteRequestLogTermNonNegInv: VoteRequestLogTermNonNegInv
AppendEntriesTermConsistentInv: AppendEntriesTermConsistentInv
SnapshotMsgIndexPositiveInv: SnapshotMsgIndexPositiveInv
ResponseTermPositiveInv: ResponseTermPositiveInv
; P2 Inflights Refined Invariants
InflightsOnlyInReplicateInv: InflightsOnlyInReplicateInv
InflightsBelowNextInv: InflightsBelowNextInv
; P3 Term and Vote Invariants
TermPositiveInv: TermPositiveInv
LeaderTermPositiveInv: LeaderTermPositiveInv
CandidateTermPositiveInv: CandidateTermPositiveInv
VotesRespondedSubsetInv: VotesRespondedSubsetInv
VotesGrantedSubsetInv: VotesGrantedSubsetInv

[properties]
MonotonicCommitIndexProp: MonotonicCommitIndexProp
MonotonicTermProp: MonotonicTermProp
MonotonicMatchIndexProp: MonotonicMatchIndexProp

[constants]
; Server model values
InitServer: [model value]<symmetrical>{s1, s2}
Server: [model value]<symmetrical>{s1, s2, s3, s4}
; Value model values
Value: [model value]<symmetrical>{v1, v2}
; Constraint limits
ReconfigurationLimit: 3
MaxTermLimit: 6
MaxTimeoutLimit: 8
RequestLimit: 6
MaxPendingMsgLimit: 10
MaxMsgBufferLimit: 16
; Network partition configuration
MaxPartitions: 2
RestartDropsMessages: FALSE
PartitionLimit: 0
; MsgNoReorder: FALSE
MsgNoReorder: TRUE
; Fault injection limits
RestartLimit: 1
DropLimit: 6
DuplicateLimit: 1
StepDownLimit: 3
HeartbeatLimit: 12
; Snapshot limits
SnapshotLimit: 3
CompactLimit: 3
; Config change limits
ConfChangeLimit: 3
; ReportUnreachable limit
ReportUnreachableLimit: 2
; Flow control
MaxInflightMsgs: 5
; Type constants
Nil: [model value]
ValueEntry: [model value]
ConfigEntry: [model value]
Follower: [model value]
Candidate: [model value]
Leader: [model value]
RequestVoteRequest: [model value]
RequestVoteResponse: [model value]
AppendEntriesRequest: [model value]
AppendEntriesResponse: [model value]
SnapshotRequest: [model value]
SnapshotResponse: [model value]
SnapshotStatus: [model value]
StateProbe: [model value]
StateReplicate: [model value]
StateSnapshot: [model value]

[override]
; Action overrides
Timeout: MCTimeout
Send: MCSend
ClientRequest: MCClientRequest
ClientRequestAndSend: MCClientRequestAndSend
AddNewServer: MCAddNewServer
DeleteServer: MCDeleteServer
AddLearner: MCAddLearner
Restart: MCRestart
DropMessage: MCDropMessage
DuplicateMessage: MCDuplicateMessage
StepDownToFollower: MCStepDown
Heartbeat: MCHeartbeat
SendSnapshot: MCSendSnapshot
CompactLog: MCCompactLog
ChangeConf: MCChangeConf
ChangeConfAndSend: MCChangeConfAndSend
ManualSendSnapshot: MCManualSendSnapshot
SendSnapshotWithCompaction: MCSendSnapshotWithCompaction
ReportUnreachable: MCReportUnreachable
; Initialization overrides
InitServerVars: etcdInitServerVars
InitLogVars: etcdInitLogVars
InitConfigVars: etcdInitConfigVars
InitDurableState: etcdInitDurableState
