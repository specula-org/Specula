SPECIFICATION mc_etcdSpec

CONSTANTS
    s1 = s1
    s2 = s2
    s3 = s3

    InitServer  = {s1, s2, s3}
    Server      = {s1, s2, s3}

    v1 = v1
    Value       = {v1}

    \* Minimal limits for BFS model checking
    ReconfigurationLimit    = 0
    MaxTermLimit            = 2
    MaxTimeoutLimit         = 2
    RequestLimit            = 4

    \* Fault injection
    RestartLimit            = 0
    DropLimit               = 2
    DuplicateLimit          = 0
    StepDownLimit           = 0
    HeartbeatLimit          = 3

    \* Snapshot and compaction - need offset >= 3
    SnapshotLimit           = 2
    CompactLimit            = 2

    \* No config changes
    ConfChangeLimit         = 0
    ReportUnreachableLimit  = 0

    \* Flow control
    MaxInflightMsgs         = 2
    MsgNoReorder            = FALSE

    \* Network
    MaxPartitions           = 1
    RestartDropsMessages    = FALSE
    PartitionLimit          = 0

    \* Message buffer
    MaxMsgBufferLimit       = 8
    MaxPendingMsgLimit      = 8

    \* Action overrides
    Timeout             <- MCTimeout
    Send                <- MCSend
    ClientRequest       <- MCClientRequest
    ClientRequestAndSend <- MCClientRequestAndSend
    AddNewServer        <- MCAddNewServer
    DeleteServer        <- MCDeleteServer
    AddLearner          <- MCAddLearner
    Restart             <- MCRestart
    DropMessage         <- MCDropMessage
    DuplicateMessage    <- MCDuplicateMessage
    StepDownToFollower  <- MCStepDown
    Heartbeat           <- MCHeartbeat
    SendSnapshot        <- MCSendSnapshot
    CompactLog          <- MCCompactLog
    ChangeConf          <- MCChangeConf
    ChangeConfAndSend   <- MCChangeConfAndSend
    ManualSendSnapshot  <- MCManualSendSnapshot
    SendSnapshotWithCompaction <- MCSendSnapshotWithCompaction
    ReportUnreachable   <- MCReportUnreachable

    \* Initialization overrides
    InitServerVars  <- etcdInitServerVars
    InitLogVars     <- etcdInitLogVars
    InitConfigVars  <- etcdInitConfigVars
    InitDurableState <- etcdInitDurableState

    \* Type constants
    Nil = Nil
    ValueEntry  = ValueEntry
    ConfigEntry = ConfigEntry
    Follower    = Follower
    Candidate   = Candidate
    Leader      = Leader
    RequestVoteRequest      = RequestVoteRequest
    RequestVoteResponse     = RequestVoteResponse
    AppendEntriesRequest    = AppendEntriesRequest
    AppendEntriesResponse   = AppendEntriesResponse
    SnapshotRequest         = SnapshotRequest
    SnapshotResponse        = SnapshotResponse
    StateProbe      = StateProbe
    StateReplicate  = StateReplicate
    StateSnapshot   = StateSnapshot

SYMMETRY Symmetry

CHECK_DEADLOCK
    FALSE

CONSTRAINT
    MsgBufferConstraint
    PendingMsgBufferConstraint

INVARIANT
    AppendEntriesPrevLogTermValidInv
